<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ESG Quick Quiz - Sustainable Learning</title>
    <link rel="stylesheet" href="css/style.css">
    <style>
        .quiz-container {
            max-width: 700px;
            margin: 2rem auto;
            animation: fadeInUp 0.8s ease-out;
        }

        .quiz-header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .quiz-header h1 {
            color: var(--primary-green);
            margin-bottom: 1rem;
        }

        .quiz-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: var(--glass-bg);
            padding: 1rem;
            border-radius: var(--border-radius-md);
            text-align: center;
            border: 1px solid var(--glass-border);
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--secondary-green);
        }

        .stat-label {
            font-size: 0.8rem;
            opacity: 0.8;
            margin-top: 0.25rem;
        }

        .question-container {
            background: var(--glass-bg);
            backdrop-filter: blur(10px);
            border: 1px solid var(--glass-border);
            border-radius: var(--border-radius-lg);
            padding: 2rem;
            margin-bottom: 2rem;
            min-height: 400px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .question-number {
            background: var(--primary-green);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-weight: bold;
        }

        .time-remaining {
            background: rgba(255, 255, 255, 0.1);
            padding: 0.5rem 1rem;
            border-radius: 15px;
            font-weight: bold;
        }

        .time-warning {
            background: rgba(239, 68, 68, 0.3);
            border: 1px solid #EF4444;
            animation: pulse 1s infinite;
        }

        .progress-container {
            margin-bottom: 2rem;
        }

        .progress-bar {
            background: rgba(255, 255, 255, 0.2);
            height: 8px;
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            background: var(--card-gradient);
            height: 100%;
            transition: width 0.5s ease;
        }

        .question-text {
            font-size: 1.2rem;
            line-height: 1.6;
            margin-bottom: 2rem;
            color: white;
        }

        .category-badge {
            display: inline-block;
            background: rgba(16, 185, 129, 0.2);
            color: var(--primary-green);
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            font-size: 0.8rem;
            margin-bottom: 1rem;
            border: 1px solid var(--primary-green);
        }

        .options-container {
            display: grid;
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .option {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid transparent;
            border-radius: var(--border-radius-md);
            padding: 1rem 1.5rem;
            cursor: pointer;
            transition: all var(--transition-normal);
            position: relative;
            overflow: hidden;
        }

        .option::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            width: 4px;
            height: 100%;
            background: transparent;
            transition: background var(--transition-normal);
        }

        .option:hover {
            background: rgba(255, 255, 255, 0.15);
            border-color: var(--primary-green);
            transform: translateX(5px);
        }

        .option:hover::before {
            background: var(--primary-green);
        }

        .option.selected {
            background: rgba(16, 185, 129, 0.2);
            border-color: var(--primary-green);
            transform: translateX(5px);
        }

        .option.selected::before {
            background: var(--primary-green);
        }

        .option.correct {
            background: rgba(16, 185, 129, 0.3);
            border-color: var(--primary-green);
            animation: correctAnswer 0.6s ease-out;
        }

        .option.wrong {
            background: rgba(239, 68, 68, 0.3);
            border-color: #EF4444;
            animation: wrongAnswer 0.6s ease-out;
        }

        .option.disabled {
            cursor: not-allowed;
            opacity: 0.7;
        }

        .quiz-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .quiz-info {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .token-indicator {
            background: var(--card-gradient);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 15px;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .results-screen {
            display: none;
            text-align: center;
            animation: fadeIn 1s ease-out;
        }

        .results-screen.show {
            display: block;
        }

        .score-circle {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            margin: 2rem auto;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            font-weight: bold;
            position: relative;
            background: conic-gradient(var(--primary-green) 0deg, var(--secondary-green) 180deg, rgba(255,255,255,0.2) 180deg);
        }

        .score-circle::before {
            content: '';
            position: absolute;
            inset: 10px;
            border-radius: 50%;
            background: var(--bg-gradient);
        }

        .score-text {
            position: relative;
            z-index: 1;
        }

        .results-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin: 2rem 0;
        }

        .result-item {
            background: var(--glass-bg);
            padding: 1rem;
            border-radius: var(--border-radius-md);
            border: 1px solid var(--glass-border);
        }

        .result-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--secondary-green);
        }

        .explanation-section {
            background: rgba(16, 185, 129, 0.1);
            border: 1px solid var(--primary-green);
            border-radius: var(--border-radius-md);
            padding: 1.5rem;
            margin: 1rem 0;
            text-align: left;
        }

        .limit-warning {
            background: rgba(239, 68, 68, 0.2);
            border: 1px solid #EF4444;
            border-radius: var(--border-radius-md);
            padding: 1rem;
            margin-bottom: 2rem;
            text-align: center;
        }

        .premium-promotion {
            background: linear-gradient(45deg, #FFD700, #FFA500);
            color: #000;
            border-radius: var(--border-radius-md);
            padding: 1.5rem;
            margin: 1rem 0;
            text-align: center;
        }

        @keyframes correctAnswer {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        @keyframes wrongAnswer {
            0% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
            100% { transform: translateX(0); }
        }

        @media (max-width: 768px) {
            .quiz-container {
                margin: 1rem;
            }
            
            .question-container {
                padding: 1.5rem;
            }
            
            .quiz-stats {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .quiz-controls {
                flex-direction: column;
                gap: 1rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="quiz-container">
            <!-- Quiz Header -->
            <div class="quiz-header">
                <h1>🧠 ESG Quick Quiz</h1>
                <p>Test your sustainable investing knowledge in 5 quick questions!</p>
            </div>

            <!-- Quiz Stats -->
            <div class="quiz-stats">
                <div class="stat-card">
                    <div class="stat-value" id="totalTokens">0</div>
                    <div class="stat-label">Total Tokens</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="todayQuizzes">0</div>
                    <div class="stat-label">Today's Quizzes</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="quizAccuracy">0%</div>
                    <div class="stat-label">Quiz Accuracy</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="quizStreak">0</div>
                    <div class="stat-label">Current Streak</div>
                </div>
            </div>

            <!-- Daily Limit Warning -->
            <div id="limitWarning" class="limit-warning" style="display: none;">
                <h3>⏰ Daily Limit Reached</h3>
                <p>You've completed your daily quiz limit. Come back tomorrow or <strong>upgrade to Premium</strong> for more games!</p>
                <div class="premium-promotion">
                    <h4>🌟 Premium Benefits</h4>
                    <p>• 10 quizzes per day (vs 3 free)<br>• 3x token multiplier<br>• Exclusive weekly challenges</p>
                    <button class="btn" onclick="upgradeToPremium()">Upgrade to Premium</button>
                </div>
            </div>

            <!-- Quiz Game Area -->
            <div id="quizGame" class="question-container">
                <div class="question-header">
                    <div class="question-number" id="questionNumber">Question 1 of 5</div>
                    <div class="time-remaining" id="timeRemaining">2:00</div>
                </div>

                <div class="progress-container">
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill"></div>
                    </div>
                </div>

                <div id="questionContent">
                    <div class="category-badge" id="questionCategory">ESG Basics</div>
                    <div class="question-text" id="questionText">Loading question...</div>
                    <div class="options-container" id="optionsContainer">
                        <!-- Options will be populated by JavaScript -->
                    </div>
                </div>

                <div class="quiz-controls">
                    <div class="quiz-info">
                        <div class="token-indicator">
                            🪙 <span id="potentialTokens">1-2 tokens</span>
                        </div>
                    </div>
                    <button class="btn" id="nextButton" onclick="nextQuestion()" disabled>
                        Next Question
                    </button>
                </div>
            </div>

            <!-- Results Screen -->
            <div id="resultsScreen" class="results-screen">
                <h2>🎉 Quiz Completed!</h2>
                
                <div class="score-circle">
                    <div class="score-text" id="finalScore">0/5</div>
                </div>

                <div class="results-details">
                    <div class="result-item">
                        <div class="result-value" id="scorePercentage">0%</div>
                        <div>Accuracy</div>
                    </div>
                    <div class="result-item">
                        <div class="result-value" id="tokensEarned">0</div>
                        <div>Tokens Earned</div>
                    </div>
                    <div class="result-item">
                        <div class="result-value" id="timeUsed">0s</div>
                        <div>Time Used</div>
                    </div>
                    <div class="result-item">
                        <div class="result-value" id="newStreak">0</div>
                        <div>Current Streak</div>
                    </div>
                </div>

                <div id="explanationSection" class="explanation-section">
                    <h4>📚 Did You Know?</h4>
                    <p id="randomFact">ESG investing has grown to over $35 trillion globally!</p>
                </div>

                <div class="flex-center" style="gap: 1rem; margin-top: 2rem;">
                    <button class="btn" onclick="playAgain()">Play Again</button>
                    <button class="btn btn-secondary" onclick="goHome()">Back to Games</button>
                </div>
            </div>
        </div>
    </div>

    <script src="js/common.js"></script>
    <script>
        // Quiz Game Logic
        class ESGQuiz {
            constructor() {
                this.questions = [];
                this.currentQuestionIndex = 0;
                this.score = 0;
                this.selectedAnswer = null;
                this.startTime = null;
                this.timeLimit = 120; // 2 minutes
                this.timer = null;
                this.gameActive = false;
                
                this.init();
            }

            async init() {
                await this.loadQuestions();
                this.updateStats();
                this.checkDailyLimit();
            }

            async loadQuestions() {
                try {
                    const response = await fetch('data/questions.json');
                    const data = await response.json();
                    
                    // Get 5 random questions for quick quiz
                    const allQuestions = data.quickQuizQuestions || [];
                    this.questions = this.shuffleArray(allQuestions).slice(0, 5);
                    
                    if (this.questions.length > 0) {
                        this.startQuiz();
                    } else {
                        this.showError("No questions available. Please try again later.");
                    }
                } catch (error) {
                    console.error('Error loading questions:', error);
                    this.showError("Failed to load questions. Please check your connection.");
                }
            }

            shuffleArray(array) {
                const shuffled = [...array];
                for (let i = shuffled.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
                }
                return shuffled;
            }

            checkDailyLimit() {
                const availability = canPlayGame('quickQuiz');
                
                if (!availability.canPlay) {
                    document.getElementById('limitWarning').style.display = 'block';
                    document.getElementById('quizGame').style.display = 'none';
                    return false;
                }
                
                return true;
            }

            startQuiz() {
                if (!this.checkDailyLimit()) return;
                
                this.gameActive = true;
                this.startTime = Date.now();
                this.currentQuestionIndex = 0;
                this.score = 0;
                this.selectedAnswer = null;
                
                this.startTimer();
                this.loadCurrentQuestion();
            }

            startTimer() {
                let timeLeft = this.timeLimit;
                const timerElement = document.getElementById('timeRemaining');
                
                this.timer = setInterval(() => {
                    timeLeft--;
                    const minutes = Math.floor(timeLeft / 60);
                    const seconds = timeLeft % 60;
                    timerElement.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
                    
                    if (timeLeft <= 30) {
                        timerElement.classList.add('time-warning');
                    }
                    
                    if (timeLeft <= 0) {
                        this.timeUp();
                    }
                }, 1000);
            }

            timeUp() {
                clearInterval(this.timer);
                this.gameActive = false;
                this.showResults();
            }

            loadCurrentQuestion() {
                if (this.currentQuestionIndex >= this.questions.length) {
                    this.showResults();
                    return;
                }

                const question = this.questions[this.currentQuestionIndex];
                const progress = ((this.currentQuestionIndex + 1) / this.questions.length) * 100;
                
                // Update UI elements
                document.getElementById('questionNumber').textContent = 
                    `Question ${this.currentQuestionIndex + 1} of ${this.questions.length}`;
                document.getElementById('progressFill').style.width = `${progress}%`;
                document.getElementById('questionCategory').textContent = question.category;
                document.getElementById('questionText').textContent = question.question;
                
                // Load options
                const optionsContainer = document.getElementById('optionsContainer');
                optionsContainer.innerHTML = '';
                
                question.options.forEach((option, index) => {
                    const optionElement = document.createElement('div');
                    optionElement.className = 'option';
                    optionElement.textContent = option;
                    optionElement.onclick = () => this.selectOption(index);
                    optionsContainer.appendChild(optionElement);
                });

                // Reset state
                this.selectedAnswer = null;
                document.getElementById('nextButton').disabled = true;
                document.getElementById('nextButton').textContent = 
                    this.currentQuestionIndex === this.questions.length - 1 ? 'Finish Quiz' : 'Next Question';
            }

            selectOption(optionIndex) {
                if (!this.gameActive) return;
                
                this.selectedAnswer = optionIndex;
                
                // Update UI
                const options = document.querySelectorAll('.option');
                options.forEach((option, index) => {
                    option.classList.remove('selected');
                    if (index === optionIndex) {
                        option.classList.add('selected');
                    }
                });
                
                document.getElementById('nextButton').disabled = false;
            }

            nextQuestion() {
                if (this.selectedAnswer === null) return;
                
                const question = this.questions[this.currentQuestionIndex];
                const isCorrect = this.selectedAnswer === question.correct;
                
                if (isCorrect) {
                    this.score++;
                }
                
                // Show correct answer
                const options = document.querySelectorAll('.option');
                options.forEach((option, index) => {
                    option.classList.add('disabled');
                    if (index === question.correct) {
                        option.classList.add('correct');
                    } else if (index === this.selectedAnswer && !isCorrect) {
                        option.classList.add('wrong');
                    }
                });
                
                // Show explanation
                if (question.explanation) {
                    const explanationElement = document.createElement('div');
                    explanationElement.className = 'explanation-section';
                    explanationElement.innerHTML = `
                        <h4>💡 Explanation</h4>
                        <p>${question.explanation}</p>
                    `;
                    document.getElementById('questionContent').appendChild(explanationElement);
                }
                
                // Wait before next question
                setTimeout(() => {
                    this.currentQuestionIndex++;
                    
                    if (this.currentQuestionIndex >= this.questions.length) {
                        this.showResults();
                    } else {
                        this.loadCurrentQuestion();
                    }
                }, 2000);
            }

            showResults() {
                clearInterval(this.timer);
                this.gameActive = false;
                
                const endTime = Date.now();
                const timeUsed = Math.round((endTime - this.startTime) / 1000);
                const accuracy = Math.round((this.score / this.questions.length) * 100);
                
                // Calculate tokens
                const performance = {
                    score: accuracy,
                    perfect: accuracy === 100,
                    timeBonus: timeUsed < 60
                };
                
                const tokensEarned = calculateTokenReward('quickQuiz', performance);
                
                // Update game stats
                addTokens(tokensEarned, 'quickQuiz', performance);
                recordGamePlay('quickQuiz');
                updateAccuracy(this.score, this.questions.length);
                updateStreak(accuracy >= 60);
                
                // Show results screen
                document.getElementById('quizGame').style.display = 'none';
                document.getElementById('resultsScreen').classList.add('show');
                
                // Update results display
                document.getElementById('finalScore').textContent = `${this.score}/${this.questions.length}`;
                document.getElementById('scorePercentage').textContent = `${accuracy}%`;
                document.getElementById('tokensEarned').textContent = tokensEarned;
                document.getElementById('timeUsed').textContent = `${timeUsed}s`;
                document.getElementById('newStreak').textContent = parseInt(localStorage.getItem('esg_streak')) || 0;
                
                // Update score circle gradient
                const scoreCircle = document.getElementById('finalScore').closest('.score-circle');
                const gradientAngle = (accuracy / 100) * 360;
                scoreCircle.style.background = `conic-gradient(var(--primary-green) 0deg, var(--secondary-green) ${gradientAngle}deg, rgba(255,255,255,0.2) ${gradientAngle}deg)`;
                
                // Show random ESG fact
                this.showRandomFact();
                
                // Update stats
                this.updateStats();
            }

            showRandomFact() {
                const facts = [
                    "ESG investing assets have grown to over $35 trillion globally!",
                    "Companies with strong ESG practices often outperform their peers.",
                    "The 'E' in ESG includes climate change, pollution, and resource management.",
                    "Social factors cover employee treatment, diversity, and community impact.",
                    "Good governance includes board oversight and business ethics.",
                    "ESG integration can help identify long-term investment risks.",
                    "Sustainable investing is also known as responsible investing.",
                    "Green bonds specifically fund environmentally beneficial projects."
                ];
                
                const randomFact = facts[Math.floor(Math.random() * facts.length)];
                document.getElementById('randomFact').textContent = randomFact;
            }

            showError(message) {
                document.getElementById('quizGame').innerHTML = `
                    <div style="text-align: center; padding: 2rem;">
                        <h3>❌ Error</h3>
                        <p>${message}</p>
                        <button class="btn" onclick="location.reload()">Try Again</button>
                    </div>
                `;
            }

            updateStats() {
                // Update token display
                document.getElementById('totalTokens').textContent = getTotalTokens();
                
                // Update today's quiz count
                const today = new Date().toISOString().split('T')[0];
                const todayQuizzes = parseInt(localStorage.getItem(`esg_quickQuiz_plays_${today}`)) || 0;
                document.getElementById('todayQuizzes').textContent = todayQuizzes;
                
                // Update accuracy
                const accuracy = parseInt(localStorage.getItem('esg_accuracy')) || 0;
                document.getElementById('quizAccuracy').textContent = `${accuracy}%`;
                
                // Update streak
                const streak = parseInt(localStorage.getItem('esg_streak')) || 0;
                document.getElementById('quizStreak').textContent = streak;
            }
        }

        // Global functions
        function playAgain() {
            location.reload();
        }

        function goHome() {
            window.location.href = 'index.html';
        }

        function upgradeToPremium() {
            setPremiumStatus(true);
            showNotification('🌟 Premium activated! Enjoy 3x tokens and unlimited games!', 'success');
            location.reload();
        }

        // Initialize quiz when page loads
        let quizGame;
        document.addEventListener('DOMContentLoaded', () => {
            quizGame = new ESGQuiz();
        });
    </script>
</body>
</html>
