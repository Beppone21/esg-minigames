<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ESG Quick Quiz - Sustainable Learning</title>
<style>
        /* === IMPROVED ESG QUIZ STYLES === */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: white;
            position: relative;
            overflow-x: hidden;
        }

        /* Beautiful animated background */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 80%, rgba(16, 185, 129, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(52, 211, 153, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(6, 182, 212, 0.2) 0%, transparent 50%);
            z-index: -1;
            animation: backgroundShift 10s ease-in-out infinite;
        }

        @keyframes backgroundShift {
            0%, 100% { 
                background: 
                    radial-gradient(circle at 20% 80%, rgba(16, 185, 129, 0.3) 0%, transparent 50%),
                    radial-gradient(circle at 80% 20%, rgba(52, 211, 153, 0.3) 0%, transparent 50%),
                    radial-gradient(circle at 40% 40%, rgba(6, 182, 212, 0.2) 0%, transparent 50%);
            }
            50% { 
                background: 
                    radial-gradient(circle at 80% 20%, rgba(16, 185, 129, 0.4) 0%, transparent 50%),
                    radial-gradient(circle at 20% 80%, rgba(52, 211, 153, 0.3) 0%, transparent 50%),
                    radial-gradient(circle at 60% 60%, rgba(6, 182, 212, 0.3) 0%, transparent 50%);
            }
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 2rem;
            position: relative;
            z-index: 1;
        }

        .quiz-container {
            animation: fadeInUp 0.8s ease-out;
        }

        .quiz-header {
            text-align: center;
            margin-bottom: 3rem;
            padding: 2rem;
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            border-radius: 25px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.2);
        }

        .quiz-header h1 {
            font-size: 3rem;
            background: linear-gradient(45deg, #10B981, #34D399, #6EE7B7);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 1rem;
            animation: titleGlow 3s ease-in-out infinite;
        }

        @keyframes titleGlow {
            0%, 100% { filter: brightness(1); }
            50% { filter: brightness(1.2); }
        }

        .quiz-header p {
            font-size: 1.2rem;
            opacity: 0.9;
            max-width: 600px;
            margin: 0 auto;
            line-height: 1.6;
        }

        .quiz-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1.5rem;
            margin-bottom: 3rem;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(15px);
            padding: 1.5rem;
            border-radius: 20px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.15);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
            transition: left 0.5s ease;
        }

        .stat-card:hover::before {
            left: 100%;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(16, 185, 129, 0.2);
            border-color: rgba(16, 185, 129, 0.3);
        }

        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            background: linear-gradient(45deg, #34D399, #10B981);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 0.5rem;
        }

        .stat-label {
            font-size: 0.9rem;
            opacity: 0.8;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .question-container {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 25px;
            padding: 3rem;
            margin-bottom: 2rem;
            min-height: 500px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.2);
            position: relative;
            overflow: hidden;
        }

        .question-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #10B981, #34D399, #6EE7B7, #34D399, #10B981);
            background-size: 200% 100%;
            animation: gradientShift 3s linear infinite;
        }

        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            100% { background-position: 200% 50%; }
        }

        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .question-number {
            background: linear-gradient(45deg, #10B981, #059669);
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 25px;
            font-weight: bold;
            box-shadow: 0 8px 20px rgba(16, 185, 129, 0.3);
            animation: pulse 2s infinite;
        }

        .time-remaining {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            padding: 0.75rem 1.5rem;
            border-radius: 20px;
            font-weight: bold;
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
        }

        .time-warning {
            background: rgba(239, 68, 68, 0.3) !important;
            border-color: #EF4444 !important;
            animation: urgentPulse 1s infinite;
        }

        @keyframes urgentPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .progress-container {
            margin-bottom: 2rem;
        }

        .progress-bar {
            background: rgba(255, 255, 255, 0.2);
            height: 12px;
            border-radius: 6px;
            overflow: hidden;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .progress-fill {
            background: linear-gradient(90deg, #10B981, #34D399);
            height: 100%;
            transition: width 0.8s ease;
            border-radius: 6px;
            position: relative;
        }

        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            animation: progressShine 2s ease-in-out infinite;
        }

        @keyframes progressShine {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .category-badge {
            display: inline-block;
            background: rgba(16, 185, 129, 0.2);
            color: #10B981;
            padding: 0.5rem 1rem;
            border-radius: 15px;
            font-size: 0.9rem;
            margin-bottom: 1.5rem;
            border: 1px solid rgba(16, 185, 129, 0.3);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .question-text {
            font-size: 1.4rem;
            line-height: 1.7;
            margin-bottom: 2.5rem;
            color: white;
            font-weight: 500;
            text-align: center;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            border-left: 4px solid #10B981;
        }

        .options-container {
            display: grid;
            gap: 1.5rem;
            margin-bottom: 2.5rem;
        }

        .option {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 255, 255, 0.15);
            border-radius: 18px;
            padding: 1.5rem 2rem;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            font-size: 1.1rem;
            line-height: 1.5;
        }

        .option::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            width: 6px;
            height: 100%;
            background: transparent;
            transition: all 0.3s ease;
        }

        .option:hover {
            background: rgba(255, 255, 255, 0.15);
            border-color: rgba(16, 185, 129, 0.5);
            transform: translateX(8px);
            box-shadow: 0 10px 25px rgba(16, 185, 129, 0.15);
        }

        .option:hover::before {
            background: linear-gradient(180deg, #10B981, #34D399);
        }

        .option.selected {
            background: rgba(16, 185, 129, 0.2);
            border-color: #10B981;
            transform: translateX(8px);
            box-shadow: 0 10px 25px rgba(16, 185, 129, 0.3);
        }

        .option.selected::before {
            background: linear-gradient(180deg, #10B981, #34D399);
        }

        .option.correct {
            background: rgba(16, 185, 129, 0.3) !important;
            border-color: #10B981 !important;
            animation: correctAnswer 0.6s ease-out;
        }

        .option.wrong {
            background: rgba(239, 68, 68, 0.3) !important;
            border-color: #EF4444 !important;
            animation: wrongAnswer 0.6s ease-out;
        }

        .option.disabled {
            cursor: not-allowed;
            opacity: 0.7;
        }

        .quiz-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .token-indicator {
            background: linear-gradient(45deg, #10B981, #34D399);
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 20px;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            box-shadow: 0 8px 20px rgba(16, 185, 129, 0.3);
            animation: tokenGlow 3s ease-in-out infinite;
        }

        @keyframes tokenGlow {
            0%, 100% { box-shadow: 0 8px 20px rgba(16, 185, 129, 0.3); }
            50% { box-shadow: 0 12px 30px rgba(16, 185, 129, 0.5); }
        }

        .btn {
            background: linear-gradient(45deg, #10B981, #059669);
            border: none;
            border-radius: 25px;
            padding: 1rem 2rem;
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-size: 1rem;
            box-shadow: 0 8px 20px rgba(16, 185, 129, 0.3);
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s ease;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 15px 35px rgba(16, 185, 129, 0.4);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.3);
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.3);
            border-color: #10B981;
        }

        .results-screen {
            display: none;
            text-align: center;
            animation: fadeIn 1s ease-out;
        }

        .results-screen.show {
            display: block;
        }

        .score-circle {
            width: 180px;
            height: 180px;
            border-radius: 50%;
            margin: 2rem auto;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            font-weight: bold;
            position: relative;
            background: conic-gradient(var(--primary-green) 0deg, var(--secondary-green) 180deg, rgba(255,255,255,0.2) 180deg);
            box-shadow: 0 20px 40px rgba(16, 185, 129, 0.3);
            animation: scoreReveal 1s ease-out;
        }

        @keyframes scoreReveal {
            0% { transform: scale(0) rotate(0deg); }
            70% { transform: scale(1.1) rotate(180deg); }
            100% { transform: scale(1) rotate(360deg); }
        }

        .score-circle::before {
            content: '';
            position: absolute;
            inset: 15px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .score-text {
            position: relative;
            z-index: 1;
            color: white;
        }

        .results-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 1.5rem;
            margin: 3rem 0;
        }

        .result-item {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(15px);
            padding: 1.5rem;
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.15);
            transition: all 0.3s ease;
        }

        .result-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(16, 185, 129, 0.2);
        }

        .result-value {
            font-size: 2rem;
            font-weight: bold;
            background: linear-gradient(45deg, #34D399, #10B981);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 0.5rem;
        }

        .explanation-section {
            background: rgba(16, 185, 129, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(16, 185, 129, 0.3);
            border-radius: 20px;
            padding: 2rem;
            margin: 2rem 0;
            text-align: left;
        }

        .limit-warning, .premium-promotion {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(15px);
            border-radius: 20px;
            padding: 2rem;
            margin-bottom: 2rem;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.15);
        }

        .premium-promotion {
            background: linear-gradient(45deg, rgba(255, 215, 0, 0.2), rgba(255, 165, 0, 0.2));
            border-color: rgba(255, 215, 0, 0.3);
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }
            
            .quiz-header h1 {
                font-size: 2rem;
            }
            
            .question-container {
                padding: 2rem;
                min-height: 400px;
            }
            
            .quiz-stats {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .question-header {
                flex-direction: column;
                text-align: center;
            }
            
            .quiz-controls {
                flex-direction: column;
                align-items: stretch;
            }
            
            .question-text {
                font-size: 1.2rem;
            }
            
            .option {
                padding: 1rem 1.5rem;
                font-size: 1rem;
            }
        }

        @media (max-width: 480px) {
            .quiz-header {
                padding: 1.5rem;
            }
            
            .quiz-header h1 {
                font-size: 1.8rem;
            }
            
            .question-container {
                padding: 1.5rem;
            }
            
            .score-circle {
                width: 150px;
                height: 150px;
                font-size: 2rem;
            }
            
            .results-details {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        /* Animation keyframes */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); }
        }

        @keyframes correctAnswer {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        @keyframes wrongAnswer {
            0% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
            100% { transform: translateX(0); }
        }

        /* CSS Variables for compatibility */
        :root {
            --primary-green: #10B981;
            --secondary-green: #34D399;
            --dark-green: #059669;
            --glass-bg: rgba(255, 255, 255, 0.08);
            --glass-border: rgba(255, 255, 255, 0.15);
            --border-radius-md: 15px;
            --border-radius-lg: 20px;
            --transition-normal: 0.3s ease;
            --card-gradient: linear-gradient(45deg, #10B981, #34D399);
            --bg-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="quiz-container">
            <!-- Quiz Header -->
            <div class="quiz-header">
                <h1>🧠 ESG Quick Quiz</h1>
                <p>Test your sustainable investing knowledge in 5 quick questions!</p>
            </div>

            <!-- Quiz Stats -->
            <div class="quiz-stats">
                <div class="stat-card">
                    <div class="stat-value" id="totalTokens">0</div>
                    <div class="stat-label">Total Tokens</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="todayQuizzes">0</div>
                    <div class="stat-label">Today's Quizzes</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="quizAccuracy">0%</div>
                    <div class="stat-label">Quiz Accuracy</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="quizStreak">0</div>
                    <div class="stat-label">Current Streak</div>
                </div>
            </div>

            <!-- Daily Limit Warning -->
            <div id="limitWarning" class="limit-warning" style="display: none;">
                <h3>⏰ Daily Limit Reached</h3>
                <p>You've completed your daily quiz limit. Come back tomorrow or <strong>upgrade to Premium</strong> for more games!</p>
                <div class="premium-promotion">
                    <h4>🌟 Premium Benefits</h4>
                    <p>• 10 quizzes per day (vs 3 free)<br>• 3x token multiplier<br>• Exclusive weekly challenges</p>
                    <button class="btn" onclick="upgradeToPremium()">Upgrade to Premium</button>
                </div>
            </div>

            <!-- Quiz Game Area -->
            <div id="quizGame" class="question-container">
                <div class="question-header">
                    <div class="question-number" id="questionNumber">Question 1 of 5</div>
                    <div class="time-remaining" id="timeRemaining">2:00</div>
                </div>

                <div class="progress-container">
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill"></div>
                    </div>
                </div>

                <div id="questionContent">
                    <div class="category-badge" id="questionCategory">ESG Basics</div>
                    <div class="question-text" id="questionText">Loading question...</div>
                    <div class="options-container" id="optionsContainer">
                        <!-- Options will be populated by JavaScript -->
                    </div>
                </div>

                <div class="quiz-controls">
                    <div class="quiz-info">
                        <div class="token-indicator">
                            🪙 <span id="potentialTokens">1-2 tokens</span>
                        </div>
                    </div>
                    <button class="btn" id="nextButton" onclick="nextQuestion()" disabled>
                        Next Question
                    </button>
                </div>
            </div>

            <!-- Results Screen -->
            <div id="resultsScreen" class="results-screen">
                <h2>🎉 Quiz Completed!</h2>
                
                <div class="score-circle">
                    <div class="score-text" id="finalScore">0/5</div>
                </div>

                <div class="results-details">
                    <div class="result-item">
                        <div class="result-value" id="scorePercentage">0%</div>
                        <div>Accuracy</div>
                    </div>
                    <div class="result-item">
                        <div class="result-value" id="tokensEarned">0</div>
                        <div>Tokens Earned</div>
                    </div>
                    <div class="result-item">
                        <div class="result-value" id="timeUsed">0s</div>
                        <div>Time Used</div>
                    </div>
                    <div class="result-item">
                        <div class="result-value" id="newStreak">0</div>
                        <div>Current Streak</div>
                    </div>
                </div>

                <div id="explanationSection" class="explanation-section">
                    <h4>📚 Did You Know?</h4>
                    <p id="randomFact">ESG investing has grown to over $35 trillion globally!</p>
                </div>

                <div class="flex-center" style="gap: 1rem; margin-top: 2rem;">
                    <button class="btn" onclick="playAgain()">Play Again</button>
                    <button class="btn btn-secondary" onclick="goHome()">Back to Games</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // === WAIT FOR DOM TO LOAD ===
        document.addEventListener('DOMContentLoaded', function() {
            
            // === LOCAL STORAGE FUNCTIONS ===
            function getTotalTokens() {
                return parseInt(localStorage.getItem('esg_total_tokens')) || 0;
            }

            function setTotalTokens(amount) {
                const maxTokens = 100;
                const finalAmount = Math.min(amount, maxTokens);
                localStorage.setItem('esg_total_tokens', finalAmount);
                updateTokenDisplay();
                return finalAmount;
            }

            function addTokens(amount) {
                const current = getTotalTokens();
                const newTotal = setTotalTokens(current + amount);
                updateStats();
                showTokenAnimation(amount);
                return newTotal;
            }

            function updateTokenDisplay() {
                const tokenElements = document.querySelectorAll('#totalTokens');
                const tokens = getTotalTokens();
                tokenElements.forEach(element => {
                    if (element) element.textContent = tokens;
                });
            }

            function updateStats() {
                const totalTokensEl = document.getElementById('totalTokens');
                if (totalTokensEl) totalTokensEl.textContent = getTotalTokens();
                
                const today = new Date().toISOString().split('T')[0];
                const todayQuizzes = parseInt(localStorage.getItem(`esg_quickQuiz_plays_${today}`)) || 0;
                const todayQuizzesEl = document.getElementById('todayQuizzes');
                if (todayQuizzesEl) todayQuizzesEl.textContent = todayQuizzes;
                
                const accuracy = parseInt(localStorage.getItem('esg_accuracy')) || 0;
                const quizAccuracyEl = document.getElementById('quizAccuracy');
                if (quizAccuracyEl) quizAccuracyEl.textContent = `${accuracy}%`;
                
                const streak = parseInt(localStorage.getItem('esg_streak')) || 0;
                const quizStreakEl = document.getElementById('quizStreak');
                if (quizStreakEl) quizStreakEl.textContent = streak;
            }

            function canPlayGame(gameType) {
                const today = new Date().toISOString().split('T')[0];
                const playKey = `esg_${gameType}_plays_${today}`;
                const plays = parseInt(localStorage.getItem(playKey)) || 0;
                const limit = 3; // Free user limit
                
                return {
                    canPlay: plays < limit,
                    plays: plays,
                    limit: limit,
                    remaining: Math.max(0, limit - plays)
                };
            }

            function recordGamePlay(gameType) {
                const today = new Date().toISOString().split('T')[0];
                const playKey = `esg_${gameType}_plays_${today}`;
                const plays = parseInt(localStorage.getItem(playKey)) || 0;
                localStorage.setItem(playKey, plays + 1);
            }

            function updateAccuracy(correct, total) {
                const accuracy = Math.round((correct / total) * 100);
                localStorage.setItem('esg_accuracy', accuracy);
            }

            function updateStreak(won) {
                const currentStreak = parseInt(localStorage.getItem('esg_streak')) || 0;
                const newStreak = won ? currentStreak + 1 : 0;
                localStorage.setItem('esg_streak', newStreak);
            }

            function showTokenAnimation(amount) {
                const animation = document.createElement('div');
                animation.style.cssText = `
                    position: fixed;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    background: linear-gradient(45deg, #10B981, #34D399);
                    color: white;
                    padding: 1rem 2rem;
                    border-radius: 20px;
                    font-size: 1.5rem;
                    font-weight: bold;
                    z-index: 1000;
                    animation: bounceIn 0.5s ease-out;
                    box-shadow: 0 10px 25px rgba(16, 185, 129, 0.4);
                `;
                animation.innerHTML = `+${amount} 🪙`;
                document.body.appendChild(animation);
                
                setTimeout(() => animation.remove(), 2000);
            }

            // Quiz Game Logic
            class ESGQuiz {
                constructor() {
                    this.questions = [];
                    this.currentQuestionIndex = 0;
                    this.score = 0;
                    this.selectedAnswer = null;
                    this.startTime = null;
                    this.timeLimit = 120; // 2 minutes
                    this.timer = null;
                    this.gameActive = false;
                    
                    this.init();
                }

                init() {
                    this.loadQuestions();
                    updateStats();
                    this.checkDailyLimit();
                }

                loadQuestions() {
                    // Integrated questions
                    const integratedQuestions = [
                        {
                            id: 1,
                            category: "ESG Basics",
                            question: "What does ESG stand for?",
                            options: [
                                "Environmental, Social, Governance",
                                "Economic, Strategic, Growth", 
                                "Equity, Sustainability, Global",
                                "Energy, Solar, Green"
                            ],
                            correct: 0,
                            explanation: "ESG stands for Environmental, Social, and Governance factors in sustainable investing."
                        },
                        {
                            id: 2,
                            category: "Environmental",
                            question: "Which is a key Environmental factor?",
                            options: [
                                "Board diversity",
                                "Carbon emissions",
                                "Executive pay",
                                "Shareholder rights"
                            ],
                            correct: 1,
                            explanation: "Carbon emissions are a fundamental environmental factor in ESG analysis."
                        },
                        {
                            id: 3,
                            category: "Social",
                            question: "Social factors in ESG include:",
                            options: [
                                "Carbon footprint",
                                "Employee treatment",
                                "Board structure",
                                "Energy usage"
                            ],
                            correct: 1,
                            explanation: "Employee treatment and workplace diversity are core social factors."
                        },
                        {
                            id: 4,
                            category: "Governance",
                            question: "Governance focuses on:",
                            options: [
                                "Environmental impact",
                                "Community relations",
                                "Corporate leadership",
                                "Product features"
                            ],
                            correct: 2,
                            explanation: "Governance examines corporate leadership and board oversight."
                        },
                        {
                            id: 5,
                            category: "ESG ETFs",
                            question: "ICLN focuses on:",
                            options: [
                                "US ESG companies",
                                "Clean energy",
                                "European stocks",
                                "Technology"
                            ],
                            correct: 1,
                            explanation: "ICLN is the iShares Global Clean Energy ETF."
                        },
                        {
                            id: 6,
                            category: "ESG Investing",
                            question: "ESG investing aims for:",
                            options: [
                                "Quick profits only",
                                "Sustainable returns with positive impact",
                                "Risk avoidance",
                                "Market timing"
                            ],
                            correct: 1,
                            explanation: "ESG investing balances financial returns with environmental and social impact."
                        },
                        {
                            id: 7,
                            category: "ESG Basics",
                            question: "Greenwashing means:",
                            options: [
                                "Cleaning pollution",
                                "Misleading environmental claims",
                                "Investing in green tech",
                                "Government policy"
                            ],
                            correct: 1,
                            explanation: "Greenwashing is making false or misleading environmental claims."
                        },
                        {
                            id: 8,
                            category: "ESG Performance",
                            question: "ESG investing has shown to:",
                            options: [
                                "Always underperform",
                                "Match or outperform traditional investing",
                                "Only work short-term",
                                "Ignore returns"
                            ],
                            correct: 1,
                            explanation: "Studies show ESG investing often matches or beats traditional returns."
                        }
                    ];

                    try {
                        // Get 5 random questions for the quiz
                        this.questions = this.shuffleArray(integratedQuestions).slice(0, 5);
                        
                        if (this.questions.length > 0) {
                            this.startQuiz();
                        } else {
                            this.showError("No questions available. Please try again later.");
                        }
                    } catch (error) {
                        console.error('Error loading questions:', error);
                        this.showError("Failed to load questions. Please check your connection.");
                    }
                }

                shuffleArray(array) {
                    const shuffled = [...array];
                    for (let i = shuffled.length - 1; i > 0; i--) {
                        const j = Math.floor(Math.random() * (i + 1));
                        [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
                    }
                    return shuffled;
                }

                checkDailyLimit() {
                    const availability = canPlayGame('quickQuiz');
                    
                    if (!availability.canPlay) {
                        const limitWarning = document.getElementById('limitWarning');
                        const quizGame = document.getElementById('quizGame');
                        if (limitWarning) limitWarning.style.display = 'block';
                        if (quizGame) quizGame.style.display = 'none';
                        return false;
                    }
                    
                    return true;
                }

                startQuiz() {
                    if (!this.checkDailyLimit()) return;
                    
                    this.gameActive = true;
                    this.startTime = Date.now();
                    this.currentQuestionIndex = 0;
                    this.score = 0;
                    this.selectedAnswer = null;
                    
                    this.startTimer();
                    this.loadCurrentQuestion();
                }

                startTimer() {
                    let timeLeft = this.timeLimit;
                    const timerElement = document.getElementById('timeRemaining');
                    
                    this.timer = setInterval(() => {
                        timeLeft--;
                        const minutes = Math.floor(timeLeft / 60);
                        const seconds = timeLeft % 60;
                        if (timerElement) {
                            timerElement.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
                            
                            if (timeLeft <= 30) {
                                timerElement.classList.add('time-warning');
                            }
                        }
                        
                        if (timeLeft <= 0) {
                            this.timeUp();
                        }
                    }, 1000);
                }

                timeUp() {
                    clearInterval(this.timer);
                    this.gameActive = false;
                    this.showResults();
                }

                loadCurrentQuestion() {
                    if (this.currentQuestionIndex >= this.questions.length) {
                        this.showResults();
                        return;
                    }

                    const question = this.questions[this.currentQuestionIndex];
                    const progress = ((this.currentQuestionIndex + 1) / this.questions.length) * 100;
                    
                    // Update UI elements safely
                    const questionNumber = document.getElementById('questionNumber');
                    if (questionNumber) {
                        questionNumber.textContent = `Question ${this.currentQuestionIndex + 1} of ${this.questions.length}`;
                    }
                    
                    const progressFill = document.getElementById('progressFill');
                    if (progressFill) {
                        progressFill.style.width = `${progress}%`;
                    }
                    
                    const questionCategory = document.getElementById('questionCategory');
                    if (questionCategory) {
                        questionCategory.textContent = question.category;
                    }
                    
                    const questionText = document.getElementById('questionText');
                    if (questionText) {
                        questionText.textContent = question.question;
                    }
                    
                    // Load options
                    const optionsContainer = document.getElementById('optionsContainer');
                    if (optionsContainer) {
                        optionsContainer.innerHTML = '';
                        
                        question.options.forEach((option, index) => {
                            const optionElement = document.createElement('div');
                            optionElement.className = 'option';
                            optionElement.textContent = option;
                            optionElement.onclick = () => this.selectOption(index);
                            optionsContainer.appendChild(optionElement);
                        });
                    }

                    // Reset state
                    this.selectedAnswer = null;
                    const nextButton = document.getElementById('nextButton');
                    if (nextButton) {
                        nextButton.disabled = true;
                        nextButton.textContent = this.currentQuestionIndex === this.questions.length - 1 ? 'Finish Quiz' : 'Next Question';
                    }
                }

                selectOption(optionIndex) {
                    if (!this.gameActive) return;
                    
                    this.selectedAnswer = optionIndex;
                    
                    // Update UI
                    const options = document.querySelectorAll('.option');
                    options.forEach((option, index) => {
                        option.classList.remove('selected');
                        if (index === optionIndex) {
                            option.classList.add('selected');
                        }
                    });
                    
                    const nextButton = document.getElementById('nextButton');
                    if (nextButton) {
                        nextButton.disabled = false;
                    }
                }

                nextQuestion() {
                    if (this.selectedAnswer === null) return;
                    
                    const question = this.questions[this.currentQuestionIndex];
                    const isCorrect = this.selectedAnswer === question.correct;
                    
                    if (isCorrect) {
                        this.score++;
                    }
                    
                    // Show correct answer
                    const options = document.querySelectorAll('.option');
                    options.forEach((option, index) => {
                        option.classList.add('disabled');
                        if (index === question.correct) {
                            option.classList.add('correct');
                        } else if (index === this.selectedAnswer && !isCorrect) {
                            option.classList.add('wrong');
                        }
                    });
                    
                    // Show explanation
                    if (question.explanation) {
                        const explanationElement = document.createElement('div');
                        explanationElement.className = 'explanation-section';
                        explanationElement.innerHTML = `
                            <h4>💡 Explanation</h4>
                            <p>${question.explanation}</p>
                        `;
                        const questionContent = document.getElementById('questionContent');
                        if (questionContent) {
                            questionContent.appendChild(explanationElement);
                        }
                    }
                    
                    // Wait before next question
                    setTimeout(() => {
                        this.currentQuestionIndex++;
                        
                        if (this.currentQuestionIndex >= this.questions.length) {
                            this.showResults();
                        } else {
                            this.loadCurrentQuestion();
                        }
                    }, 2500);
                }

                showResults() {
                    clearInterval(this.timer);
                    this.gameActive = false;
                    
                    const endTime = Date.now();
                    const timeUsed = Math.round((endTime - this.startTime) / 1000);
                    const accuracy = Math.round((this.score / this.questions.length) * 100);
                    
                    // Calculate tokens
                    const tokensEarned = accuracy >= 80 ? 2 : 1;
                    
                    // Update game stats
                    addTokens(tokensEarned);
                    recordGamePlay('quickQuiz');
                    updateAccuracy(this.score, this.questions.length);
                    updateStreak(accuracy >= 60);
                    
                    // Show results screen
                    const quizGame = document.getElementById('quizGame');
                    const resultsScreen = document.getElementById('resultsScreen');
                    
                    if (quizGame) quizGame.style.display = 'none';
                    if (resultsScreen) resultsScreen.classList.add('show');
                    
                    // Update results display safely
                    const finalScore = document.getElementById('finalScore');
                    if (finalScore) finalScore.textContent = `${this.score}/${this.questions.length}`;
                    
                    const scorePercentage = document.getElementById('scorePercentage');
                    if (scorePercentage) scorePercentage.textContent = `${accuracy}%`;
                    
                    const tokensEarnedEl = document.getElementById('tokensEarned');
                    if (tokensEarnedEl) tokensEarnedEl.textContent = tokensEarned;
                    
                    const timeUsedEl = document.getElementById('timeUsed');
                    if (timeUsedEl) timeUsedEl.textContent = `${timeUsed}s`;
                    
                    const newStreakEl = document.getElementById('newStreak');
                    if (newStreakEl) newStreakEl.textContent = parseInt(localStorage.getItem('esg_streak')) || 0;
                    
                    // Show random ESG fact
                    this.showRandomFact();
                    
                    // Update stats
                    updateStats();
                }

                showRandomFact() {
                    const facts = [
                        "ESG investing assets have grown to over $35 trillion globally!",
                        "Companies with strong ESG practices often outperform their peers.",
                        "The 'E' in ESG includes climate change, pollution, and resource management.",
                        "Social factors cover employee treatment, diversity, and community impact.",
                        "Good governance includes board oversight and business ethics."
                    ];
                    
                    const randomFact = facts[Math.floor(Math.random() * facts.length)];
                    const randomFactEl = document.getElementById('randomFact');
                    if (randomFactEl) randomFactEl.textContent = randomFact;
                }

                showError(message) {
                    const quizGame = document.getElementById('quizGame');
                    if (quizGame) {
                        quizGame.innerHTML = `
                            <div style="text-align: center; padding: 2rem;">
                                <h3>❌ Error</h3>
                                <p>${message}</p>
                                <button class="btn" onclick="location.reload()">Try Again</button>
                            </div>
                        `;
                    }
                }
            }

            // Global functions
            window.nextQuestion = function() {
                if (window.quizGame) {
                    window.quizGame.nextQuestion();
                }
            }

            window.playAgain = function() {
                location.reload();
            }

            window.goHome = function() {
                window.location.href = 'index.html';
            }

            window.upgradeToPremium = function() {
                localStorage.setItem('esg_premium_user', 'true');
                alert('🌟 Premium activated! Enjoy unlimited games!');
                location.reload();
            }

            // Initialize quiz
            window.quizGame = new ESGQuiz();
            
            // Add CSS for animations
            const style = document.createElement('style');
            style.textContent = `
                @keyframes bounceIn {
                    0% { transform: translate(-50%, -50%) scale(0); opacity: 0; }
                    50% { transform: translate(-50%, -50%) scale(1.2); opacity: 1; }
                    100% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
                }
            `;
            document.head.appendChild(style);
        });
    </script>
</html>
